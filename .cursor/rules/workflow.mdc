---
alwaysApply: true
---
# Aldi Meal Planning Automation - Cursor AI Workflow

## Project Overview

**Goal:** Automate budget-friendly meal planning using Notion as the source of truth for Aldi recipes and ingredients, enabling automated weekly meal plan generation within budget constraints.

**Current Status:** Foundation is in place with Notion databases populated, but automation tools need to be built.

---

## Current State Analysis

### ‚úÖ What's Working

**Notion Setup (Already Complete):**
- **Recipes Database:** 8 recipes with full data (costs, servings, ingredients, relations)
  - Example: Taco Pasta Casserole ($7.78 / 6 servings = $1.30/serving)
  - Each recipe has ingredient relations, cost calculations, and categorization
- **Ingredients Database:** Hundreds of Aldi items with prices
  - Comprehensive price list (ground beef, rice, produce, dairy, etc.)
  - Categorized (ü•¶ Veggie, ü•© Meat, üßÄ Dairy, etc.)
  - Prices current as of recent shopping trips
- **Database Relations:** Recipes ‚Üî Ingredients properly linked
- **Notion API Access:** Integration token and database IDs configured in `.env`

### ‚ùå What's Not Working

**Data Collection Issues:**
1. **Recipe scraping extracting too much content** - entire page HTML instead of clean recipe titles
2. **Ingredient extraction completely failing** - returns empty arrays
3. **Price scraping returned empty** - `aldi-prices-1761982481526.json` is empty array

**Missing Automation:**
1. No easy way to add new recipes to Notion
2. No meal plan generator
3. No budget optimization logic
4. No grocery list consolidation

---

## Technical Specifications

### Tech Stack
- **Runtime:** Node.js v18+
- **Notion API:** @notionhq/client
- **Data Storage:** Notion databases (primary), JSON snapshots (backup)
- **Scripting:** JavaScript/Node.js

### Notion Database Schemas

**Aldi Recipes Database:**
```javascript
{
  "Recipe Name": "title",
  "Category": "select", // Beef, Chicken, Pork, Vegetarian, Seafood, Other
  "Cost ($)": "number",
  "Cost per Serving ($)": "number",
  "Servings": "number",
  "Recipe Ingredients": "text", // Full ingredient list
  "Instructions": "text",
  "Source/Link": "url",
  "Database Ingredients": "relation", // ‚Üí Aldi Ingredients
  "Tags": "multi_select", // Pasta, Sheet Pan, One-Pot, etc.
  "Rating": "select", // ‚òÖ to ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ
  "Notes": "text"
}
```

**Aldi Ingredients Database:**
```javascript
{
  "Item": "title",
  "Category": "select", // ü•¶ Veggie, üßÄ Dairy, ü•© Meat, etc.
  "Cost": "number",
  "Unit": "text", // lb, gal, bag, etc.
  "Price per unit": "number",
  "Recipe": "relation", // ‚Üí Aldi Recipes
  "Notes": "text"
}
```

**Aldi Meal Planner Database:**
```javascript
{
  "Date": "date",
  "Meal": "relation", // ‚Üí Aldi Recipes
  "Day of Week": "select",
  "Week Number": "number",
  "Notes": "text"
}
```

### Environment Configuration
```bash
# .env file (already configured)
NOTION_API_KEY=secret_...
NOTION_INGREDIENTS_DB_ID=27d2bdca-781f-42f0-8b5f-1927fec26d8a
NOTION_RECIPES_DB_ID=9b818405-7376-4924-a0be-3b48c7bf2f4a
NOTION_MEAL_PLANNER_DB_ID=<to be confirmed>
```

---

## Implementation Plan

### Phase 1: Recipe Collection Enhancement (Week 1)

**Goal:** Build from 8 recipes to 25+ budget-friendly recipes

#### Task 1.1: Curate Recipes from Scraped Data
**File to create:** `scripts/curate-recipes.js`

**Implementation:**
```javascript
// Read aldi-recipes-1761982847928.json
// Filter for:
// - totalCost between $5-$15
// - familySize 4-6
// - recipes array not empty
// Output: curated-recipes.json with top 20 candidates
```

**Manual Step:** Review `curated-recipes.json` and select 15 to add to Notion

#### Task 1.2: Recipe Import Helper CLI
**File to create:** `scripts/add-recipe-interactive.js`

**Features:**
- Interactive prompts for recipe details
- Ingredient matching against existing Notion ingredients
- Auto-calculation of total cost based on linked ingredients
- Creates recipe in Notion with all relations

**Usage:**
```bash
node scripts/add-recipe-interactive.js
```

**Prompts:**
1. Recipe name
2. Servings
3. Category
4. Source URL (optional)
5. Paste ingredients (one per line)
6. Instructions (optional)

**Logic:**
- For each ingredient, search Notion Ingredients DB
- If found: link it and add to cost calculation
- If not found: prompt for cost, create new ingredient entry
- Calculate total cost and cost-per-serving
- Create recipe with all relations

---

### Phase 2: Meal Plan Generator (Week 2)

**Goal:** Automate weekly meal planning within budget constraints

#### Task 2.1: Budget Meal Plan Generator
**File to create:** `scripts/generate-meal-plan.js`

**Features:**
- Query Notion Recipes database
- Filter recipes by budget constraints
- Optimize for ingredient overlap (minimize waste)
- Generate 7-day meal plan
- Calculate exact costs
- Create entries in Meal Planner database
- Output consolidated grocery list

**Usage:**
```bash
node scripts/generate-meal-plan.js --budget 75 --servings 4 --start-date 2025-11-04
```

**Algorithm:**
```
1. Fetch all recipes from Notion
2. Filter by cost-per-serving * servings <= dailyBudget
3. Sort by:
   - Ingredient overlap score (prefer recipes sharing ingredients)
   - Cost efficiency ($/serving)
   - Category diversity (vary protein types)
4. Select 6 dinners + 1 leftover night
5. Calculate total cost
6. If over budget, swap most expensive recipe
7. Create meal plan entries in Notion
8. Generate shopping list with quantities
```

**Output Example:**
```
‚úÖ Meal Plan Generated: Week of Nov 4-10, 2025
Budget: $75.00 | Actual: $68.42 | Savings: $6.58

Monday: Taco Pasta Casserole ($7.78)
Tuesday: Chicken Stir Fry Noodles ($7.91)
Wednesday: Leftovers ($0)
Thursday: Spaghetti Night ($11.98)
Friday: Sheet Pan Honey Chicken Sausage ($9.90)
Saturday: Cheeseburger Bowls ($11.63)
Sunday: Lemon Garlic Butter Shrimp ($9.44)

üìù Shopping List:
ü•© Meat:
  - Ground beef, 2 lb ($7.98)
  - Chicken breast, 3 pieces ($4.50)
  - Frozen shrimp, 1 bag ($6.25)
  
üçû Starch/Carb:
  - Long grain rice, 3 lb ($1.99)
  - Pasta, 2 boxes ($2.78)
  
ü•¶ Veggie:
  - Zucchini, 2 lb ($2.90)
  - Green beans, 1 lb ($1.99)
  
üìä Total: $68.42
```

#### Task 2.2: Grocery List Consolidator
**File to create:** `scripts/generate-grocery-list.js`

**Features:**
- Read meal plan from Notion
- Aggregate all ingredients
- Combine duplicate items with quantities
- Group by category (Meat, Veggie, Dairy, etc.)
- Calculate total cost
- Output formatted list

**Usage:**
```bash
node scripts/generate-grocery-list.js --week 2025-11-04
```

---

### Phase 3: Recipe Cost Optimizer (Week 3)

**Goal:** Keep ingredient costs updated and optimize recipe costs

#### Task 3.1: Price Update Tool
**File to create:** `scripts/update-prices.js`

**Features:**
- Read ingredient list from Notion
- Prompt user to update prices (batch entry)
- Update Notion Ingredients database
- Recalculate all recipe costs based on new prices

**Usage:**
```bash
node scripts/update-prices.js
# Or for specific items:
node scripts/update-prices.js --items "ground beef,chicken breast,eggs"
```

#### Task 3.2: Recipe Cost Analyzer
**File to create:** `scripts/analyze-recipe-costs.js`

**Features:**
- Query all recipes
- Calculate current costs based on latest ingredient prices
- Update recipe costs in Notion
- Generate cost report
- Flag recipes that exceed budget thresholds

**Output:**
```
üìä Recipe Cost Analysis (as of Nov 2, 2025)

Budget-Friendly (< $10):
‚úÖ Taco Pasta Casserole: $7.78 ($1.30/serving)
‚úÖ Chicken Stir Fry: $7.91 ($1.98/serving)
‚úÖ Lemon Garlic Shrimp: $9.44 ($1.57/serving)

Moderate ($10-$15):
‚ö†Ô∏è  Spaghetti Night: $11.98 ($2.00/serving)
‚ö†Ô∏è  Cheeseburger Bowls: $11.63 ($2.91/serving)

‚ö° Average cost per recipe: $9.43
‚ö° Average cost per serving: $1.95
```

---

### Phase 4: Enhanced Features (Future)

#### Task 4.1: Recipe Substitution Engine
Suggest ingredient swaps to reduce costs while maintaining recipe integrity.

#### Task 4.2: Meal Prep Optimizer
Group recipes by prep technique (sheet pan, one-pot, etc.) for efficient cooking.

#### Task 4.3: Leftover Tracker
Track what was actually cooked and suggest recipes using leftover ingredients.

#### Task 4.4: Web Scraper Fixes
Fix the existing web scraping issues for automated recipe discovery.

---

## File Structure

```
aldi_meal_planning/
‚îú‚îÄ‚îÄ .env                              # Already exists - API keys
‚îú‚îÄ‚îÄ package.json                      # Already exists
‚îú‚îÄ‚îÄ README.md                         # Already exists
‚îú‚îÄ‚îÄ CURSOR_AI_WORKFLOW.md            # This file
‚îÇ
‚îú‚îÄ‚îÄ src/                              # Existing source code
‚îÇ   ‚îú‚îÄ‚îÄ index.js                      # Main pipeline
‚îÇ   ‚îú‚îÄ‚îÄ scrapers/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pricesScraper.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ recipesScraper.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ sources.js
‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ scraper.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ parser.js
‚îÇ   ‚îî‚îÄ‚îÄ notion/
‚îÇ       ‚îú‚îÄ‚îÄ notionClient.js
‚îÇ       ‚îî‚îÄ‚îÄ syncToNotion.js
‚îÇ
‚îú‚îÄ‚îÄ scripts/                          # NEW - Automation scripts
‚îÇ   ‚îú‚îÄ‚îÄ curate-recipes.js            # Task 1.1
‚îÇ   ‚îú‚îÄ‚îÄ add-recipe-interactive.js    # Task 1.2
‚îÇ   ‚îú‚îÄ‚îÄ generate-meal-plan.js        # Task 2.1
‚îÇ   ‚îú‚îÄ‚îÄ generate-grocery-list.js     # Task 2.2
‚îÇ   ‚îú‚îÄ‚îÄ update-prices.js             # Task 3.1
‚îÇ   ‚îî‚îÄ‚îÄ analyze-recipe-costs.js      # Task 3.2
‚îÇ
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ prices/                       # Already exists
‚îÇ   ‚îú‚îÄ‚îÄ recipes/                      # Already exists
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ aldi-recipes-1761982847928.json  # Scraped data
‚îÇ   ‚îî‚îÄ‚îÄ curated-recipes.json         # NEW - Filtered recipes
‚îÇ
‚îî‚îÄ‚îÄ logs/                             # Already exists
```

---

## Development Guidelines

### Code Style
- Use parentheses around arrow function parameters: `(item) => item.price`
- Minimal spaces inside object braces: `{name, cost}`
- Clear variable names, avoid abbreviations
- Add comments for complex logic

### Error Handling
- Always wrap Notion API calls in try-catch
- Provide helpful error messages
- Log errors to console with context

### Testing Approach
- Test with small datasets first (1-2 recipes)
- Verify Notion entries manually after script runs
- Use `--dry-run` flags where possible

---

## Immediate Next Steps

### Step 1: Set Up Scripts Directory
```bash
# Run in project root
mkdir -p scripts
```

### Step 2: Verify Notion Access
```bash
# Run existing sync to confirm API connection
npm run sync:notion
```

### Step 3: Implement Task 1.1 (Curate Recipes)
Create `scripts/curate-recipes.js` using the scraped JSON data to identify top recipe candidates.

### Step 4: Manual Recipe Addition
Add 10-15 recipes to Notion manually to reach ~20 total recipes.

### Step 5: Implement Task 2.1 (Meal Plan Generator)
Build the core automation - weekly meal planning within budget.

---

## Success Criteria

**Phase 1 Complete:**
- [ ] 25+ recipes in Notion
- [ ] All recipes have cost calculations
- [ ] All recipes linked to ingredients

**Phase 2 Complete:**
- [ ] Can generate 7-day meal plan in < 30 seconds
- [ ] Meal plans stay within budget 95% of time
- [ ] Grocery lists properly consolidated

**Phase 3 Complete:**
- [ ] Can update ingredient prices in < 5 minutes
- [ ] Recipe costs auto-recalculate on price updates
- [ ] Cost analysis reports generated on demand

---

## Common Commands

```bash
# Add a new recipe interactively
node scripts/add-recipe-interactive.js

# Generate this week's meal plan
node scripts/generate-meal-plan.js --budget 75 --servings 4

# Generate grocery list for current week
node scripts/generate-grocery-list.js --week 2025-11-04

# Update ingredient prices
node scripts/update-prices.js

# Analyze recipe costs
node scripts/analyze-recipe-costs.js

# Original pipeline (web scraping - currently broken)
npm run pipeline
```

---

## Troubleshooting

### Issue: "Notion API rate limit exceeded"
**Solution:** Add delays between API calls (already implemented in notionClient.js)

### Issue: "Recipe not found in Notion"
**Solution:** Check database ID in .env matches the actual Notion database

### Issue: "Cost calculation returns NaN"
**Solution:** Verify all linked ingredients have valid Cost values in Notion

### Issue: "Meal plan exceeds budget"
**Solution:** Lower the per-meal budget threshold or add more budget-friendly recipes

---

## Notes for Cursor AI

- **Prioritize:** Start with Phase 1, Task 1.2 (add-recipe-interactive.js) - this unlocks rapid recipe addition
- **Quick Win:** Task 2.1 (generate-meal-plan.js) provides immediate value once enough recipes exist
- **Data Source:** Use `data/recipes/aldi-recipes-1761982847928.json` for initial recipe discovery
- **Notion Integration:** Use existing `src/notion/notionClient.js` for all Notion API interactions
- **Testing:** Always test scripts with `console.log()` output before writing to Notion

---

## Project Owner Preferences

- **Keep it simple:** Prefer clear, readable code over clever optimizations
- **Professional but practical:** Concise code with helpful comments
- **Error messages:** Clear and actionable
- **CLI output:** Use emojis and formatting for readability
- **Always confirm:** Destructive operations (delete, bulk update) should require confirmation

---

**Last Updated:** 2025-11-02
**Status:** Ready for implementation